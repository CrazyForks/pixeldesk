<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户状态显示组件测试</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Retro theme colors */
        :root {
            --retro-bg: #0a0a0a;
            --retro-bg-darker: #050505;
            --retro-border: #333333;
            --retro-text: #ffffff;
            --retro-textMuted: #888888;
            --retro-purple: #8b5cf6;
            --retro-pink: #ec4899;
            --retro-blue: #3b82f6;
            --retro-cyan: #06b6d4;
        }
        
        body {
            background-color: var(--retro-bg);
            color: var(--retro-text);
            font-family: 'Inter', sans-serif;
        }
        
        .bg-retro-bg { background-color: var(--retro-bg); }
        .bg-retro-bg-darker { background-color: var(--retro-bg-darker); }
        .border-retro-border { border-color: var(--retro-border); }
        .text-retro-text { color: var(--retro-text); }
        .text-retro-textMuted { color: var(--retro-textMuted); }
        .bg-retro-purple { background-color: var(--retro-purple); }
        .bg-retro-pink { background-color: var(--retro-pink); }
        .bg-retro-blue { background-color: var(--retro-blue); }
        .bg-retro-cyan { background-color: var(--retro-cyan); }
        .from-retro-purple { --tw-gradient-from: var(--retro-purple); }
        .to-retro-pink { --tw-gradient-to: var(--retro-pink); }
        .from-retro-blue { --tw-gradient-from: var(--retro-blue); }
        .to-retro-cyan { --tw-gradient-to: var(--retro-cyan); }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // UserStatusIndicator Component
        function UserStatusIndicator({ isOnline, lastSeen, size = 'md', showText = false, className = '' }) {
            const sizeClasses = {
                sm: 'w-2 h-2',
                md: 'w-3 h-3', 
                lg: 'w-4 h-4'
            };

            const textSizeClasses = {
                sm: 'text-xs',
                md: 'text-sm',
                lg: 'text-base'
            };

            const formatLastSeen = useMemo(() => {
                if (!lastSeen || isOnline) return null;

                const lastSeenDate = new Date(lastSeen);
                const now = new Date();
                const diffMs = now.getTime() - lastSeenDate.getTime();
                const diffMinutes = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

                if (diffMinutes < 1) {
                    return '刚刚在线';
                } else if (diffMinutes < 60) {
                    return `${diffMinutes}分钟前在线`;
                } else if (diffHours < 24) {
                    return `${diffHours}小时前在线`;
                } else if (diffDays < 7) {
                    return `${diffDays}天前在线`;
                } else {
                    return lastSeenDate.toLocaleDateString('zh-CN', {
                        month: 'short',
                        day: 'numeric'
                    }) + '在线';
                }
            }, [lastSeen, isOnline]);

            if (showText) {
                return (
                    <div className={`flex items-center space-x-2 ${className}`}>
                        <div className={`${sizeClasses[size]} rounded-full border border-gray-800 ${
                            isOnline 
                                ? 'bg-green-400 animate-pulse' 
                                : 'bg-gray-400'
                        }`} />
                        <span className={`${textSizeClasses[size]} ${
                            isOnline 
                                ? 'text-green-400' 
                                : 'text-gray-400'
                        }`}>
                            {isOnline ? '在线' : formatLastSeen || '离线'}
                        </span>
                    </div>
                );
            }

            return (
                <div 
                    className={`${sizeClasses[size]} rounded-full border border-gray-800 ${
                        isOnline 
                            ? 'bg-green-400 animate-pulse' 
                            : 'bg-gray-400'
                    } ${className}`}
                    title={isOnline ? '在线' : formatLastSeen || '离线'}
                />
            );
        }

        // UserAvatar Component
        function UserAvatar({ 
            userId, 
            userName, 
            userAvatar, 
            isOnline = false, 
            lastSeen, 
            size = 'md', 
            showStatus = true, 
            statusPosition = 'bottom-right', 
            className = '', 
            onClick 
        }) {
            const [imageError, setImageError] = useState(false);

            const sizeClasses = {
                xs: 'w-6 h-6',
                sm: 'w-8 h-8',
                md: 'w-10 h-10',
                lg: 'w-12 h-12',
                xl: 'w-16 h-16'
            };

            const textSizeClasses = {
                xs: 'text-xs',
                sm: 'text-sm',
                md: 'text-sm',
                lg: 'text-base',
                xl: 'text-lg'
            };

            const statusSizeClasses = {
                xs: 'sm',
                sm: 'sm',
                md: 'md',
                lg: 'md',
                xl: 'lg'
            };

            const statusPositionClasses = {
                'bottom-right': '-bottom-0.5 -right-0.5',
                'bottom-left': '-bottom-0.5 -left-0.5',
                'top-right': '-top-0.5 -right-0.5',
                'top-left': '-top-0.5 -left-0.5'
            };

            const getInitials = (name) => {
                if (!name) return '?';
                const words = name.trim().split(' ');
                if (words.length === 1) {
                    return words[0].charAt(0).toUpperCase();
                }
                return (words[0].charAt(0) + words[words.length - 1].charAt(0)).toUpperCase();
            };

            const handleImageError = () => {
                setImageError(true);
            };

            return (
                <div 
                    className={`relative flex-shrink-0 ${onClick ? 'cursor-pointer' : ''} ${className}`}
                    onClick={onClick}
                >
                    <div className={`${sizeClasses[size]} bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center overflow-hidden`}>
                        {userAvatar && !imageError ? (
                            <img 
                                src={userAvatar} 
                                alt={userName}
                                className="w-full h-full object-cover"
                                onError={handleImageError}
                            />
                        ) : (
                            <span className={`text-white font-medium ${textSizeClasses[size]}`}>
                                {getInitials(userName)}
                            </span>
                        )}
                    </div>
                    
                    {showStatus && (
                        <div className={`absolute ${statusPositionClasses[statusPosition]}`}>
                            <UserStatusIndicator
                                isOnline={isOnline}
                                lastSeen={lastSeen}
                                size={statusSizeClasses[size]}
                            />
                        </div>
                    )}
                </div>
            );
        }

        // LastSeenDisplay Component
        function LastSeenDisplay({ lastSeen, isOnline, format = 'smart', className = '' }) {
            const [currentTime, setCurrentTime] = useState(new Date());

            useEffect(() => {
                if (format === 'relative' || format === 'smart') {
                    const interval = setInterval(() => {
                        setCurrentTime(new Date());
                    }, 60000); // Update every minute

                    return () => clearInterval(interval);
                }
            }, [format]);

            const formattedTime = useMemo(() => {
                if (isOnline) {
                    return '在线';
                }

                if (!lastSeen) {
                    return '离线';
                }

                const lastSeenDate = new Date(lastSeen);
                const now = currentTime;
                const diffMs = now.getTime() - lastSeenDate.getTime();
                const diffMinutes = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

                switch (format) {
                    case 'relative':
                        if (diffMinutes < 1) {
                            return '刚刚在线';
                        } else if (diffMinutes < 60) {
                            return `${diffMinutes}分钟前`;
                        } else if (diffHours < 24) {
                            return `${diffHours}小时前`;
                        } else if (diffDays < 7) {
                            return `${diffDays}天前`;
                        } else {
                            return '很久之前';
                        }

                    case 'absolute':
                        if (diffDays < 1) {
                            return lastSeenDate.toLocaleTimeString('zh-CN', {
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        } else if (diffDays < 7) {
                            return lastSeenDate.toLocaleDateString('zh-CN', {
                                weekday: 'short',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        } else {
                            return lastSeenDate.toLocaleDateString('zh-CN', {
                                month: 'short',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        }

                    case 'smart':
                    default:
                        if (diffMinutes < 1) {
                            return '刚刚在线';
                        } else if (diffMinutes < 60) {
                            return `${diffMinutes}分钟前在线`;
                        } else if (diffHours < 24) {
                            return `${diffHours}小时前在线`;
                        } else if (diffDays < 7) {
                            return `${diffDays}天前在线`;
                        } else {
                            return lastSeenDate.toLocaleDateString('zh-CN', {
                                month: 'short',
                                day: 'numeric'
                            }) + '在线';
                        }
                }
            }, [lastSeen, isOnline, currentTime, format]);

            const getStatusColor = () => {
                if (isOnline) {
                    return 'text-green-400';
                }

                if (!lastSeen) {
                    return 'text-gray-400';
                }

                const lastSeenDate = new Date(lastSeen);
                const now = currentTime;
                const diffHours = Math.floor((now.getTime() - lastSeenDate.getTime()) / (1000 * 60 * 60));

                if (diffHours < 1) {
                    return 'text-yellow-400';
                } else if (diffHours < 24) {
                    return 'text-orange-400';
                } else {
                    return 'text-gray-400';
                }
            };

            return (
                <span 
                    className={`${getStatusColor()} ${className}`}
                    title={lastSeen ? `最后在线: ${new Date(lastSeen).toLocaleString('zh-CN')}` : '离线'}
                >
                    {formattedTime}
                </span>
            );
        }

        // Demo Component
        function UserStatusDemo() {
            const [isOnline, setIsOnline] = useState(true);
            const [lastSeen, setLastSeen] = useState(new Date(Date.now() - 5 * 60 * 1000).toISOString());

            return (
                <div className="p-6 bg-retro-bg-darker rounded-lg space-y-6 max-w-4xl mx-auto">
                    <h2 className="text-white text-xl font-bold mb-4">用户状态显示组件演示</h2>
                    
                    {/* Controls */}
                    <div className="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
                        <button
                            onClick={() => setIsOnline(!isOnline)}
                            className="bg-purple-600 hover:bg-pink-600 text-white px-4 py-2 rounded-lg transition-colors"
                        >
                            切换在线状态: {isOnline ? '在线' : '离线'}
                        </button>
                        <button
                            onClick={() => setLastSeen(isOnline ? null : new Date(Date.now() - Math.random() * 24 * 60 * 60 * 1000).toISOString())}
                            className="bg-blue-600 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg transition-colors"
                        >
                            随机最后在线时间
                        </button>
                    </div>

                    {/* Status Indicator Demo */}
                    <div className="space-y-4">
                        <h3 className="text-white text-lg font-semibold">状态指示器</h3>
                        <div className="flex items-center space-x-6">
                            <div className="flex items-center space-x-2">
                                <span className="text-gray-400">小:</span>
                                <UserStatusIndicator isOnline={isOnline} lastSeen={lastSeen} size="sm" />
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="text-gray-400">中:</span>
                                <UserStatusIndicator isOnline={isOnline} lastSeen={lastSeen} size="md" />
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="text-gray-400">大:</span>
                                <UserStatusIndicator isOnline={isOnline} lastSeen={lastSeen} size="lg" />
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="text-gray-400">带文字:</span>
                                <UserStatusIndicator isOnline={isOnline} lastSeen={lastSeen} size="md" showText={true} />
                            </div>
                        </div>
                    </div>

                    {/* User Avatar Demo */}
                    <div className="space-y-4">
                        <h3 className="text-white text-lg font-semibold">用户头像</h3>
                        <div className="flex items-center space-x-6">
                            <div className="flex flex-col items-center space-y-2">
                                <UserAvatar
                                    userId="demo1"
                                    userName="张三"
                                    isOnline={isOnline}
                                    lastSeen={lastSeen}
                                    size="xs"
                                />
                                <span className="text-xs text-gray-400">XS</span>
                            </div>
                            <div className="flex flex-col items-center space-y-2">
                                <UserAvatar
                                    userId="demo2"
                                    userName="李四"
                                    isOnline={isOnline}
                                    lastSeen={lastSeen}
                                    size="sm"
                                />
                                <span className="text-xs text-gray-400">SM</span>
                            </div>
                            <div className="flex flex-col items-center space-y-2">
                                <UserAvatar
                                    userId="demo3"
                                    userName="王五"
                                    isOnline={isOnline}
                                    lastSeen={lastSeen}
                                    size="md"
                                />
                                <span className="text-xs text-gray-400">MD</span>
                            </div>
                            <div className="flex flex-col items-center space-y-2">
                                <UserAvatar
                                    userId="demo4"
                                    userName="赵六"
                                    isOnline={isOnline}
                                    lastSeen={lastSeen}
                                    size="lg"
                                />
                                <span className="text-xs text-gray-400">LG</span>
                            </div>
                            <div className="flex flex-col items-center space-y-2">
                                <UserAvatar
                                    userId="demo5"
                                    userName="钱七"
                                    isOnline={isOnline}
                                    lastSeen={lastSeen}
                                    size="xl"
                                />
                                <span className="text-xs text-gray-400">XL</span>
                            </div>
                        </div>
                    </div>

                    {/* Last Seen Display Demo */}
                    <div className="space-y-4">
                        <h3 className="text-white text-lg font-semibold">最后在线时间显示</h3>
                        <div className="space-y-2">
                            <div className="flex items-center space-x-4">
                                <span className="text-gray-400 w-16">智能:</span>
                                <LastSeenDisplay lastSeen={lastSeen} isOnline={isOnline} format="smart" />
                            </div>
                            <div className="flex items-center space-x-4">
                                <span className="text-gray-400 w-16">相对:</span>
                                <LastSeenDisplay lastSeen={lastSeen} isOnline={isOnline} format="relative" />
                            </div>
                            <div className="flex items-center space-x-4">
                                <span className="text-gray-400 w-16">绝对:</span>
                                <LastSeenDisplay lastSeen={lastSeen} isOnline={isOnline} format="absolute" />
                            </div>
                        </div>
                    </div>

                    {/* Combined Example */}
                    <div className="space-y-4">
                        <h3 className="text-white text-lg font-semibold">组合示例</h3>
                        <div className="flex items-center space-x-4 p-4 bg-gray-800 rounded-lg">
                            <UserAvatar
                                userId="combined"
                                userName="示例用户"
                                isOnline={isOnline}
                                lastSeen={lastSeen}
                                size="lg"
                            />
                            <div>
                                <div className="text-white font-medium">示例用户</div>
                                <LastSeenDisplay lastSeen={lastSeen} isOnline={isOnline} format="smart" className="text-sm" />
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<UserStatusDemo />, document.getElementById('root'));
    </script>
</body>
</html>