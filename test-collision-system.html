<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¢°æ’æ£€æµ‹ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ç¢°æ’æ£€æµ‹ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
            <button class="test-button" onclick="checkSystemStatus()">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
            <div id="system-status"></div>
        </div>
        
        <div class="test-section">
            <h3>ç¢°æ’äº‹ä»¶æµ‹è¯•</h3>
            <button class="test-button" onclick="testCollisionEvents()">æµ‹è¯•ç¢°æ’äº‹ä»¶</button>
            <button class="test-button" onclick="getCurrentCollisions()">è·å–å½“å‰ç¢°æ’</button>
            <button class="test-button" onclick="getCollisionHistory()">è·å–ç¢°æ’å†å²</button>
            <div id="collision-status"></div>
        </div>
        
        <div class="test-section">
            <h3>é˜²æŠ–æœºåˆ¶æµ‹è¯•</h3>
            <button class="test-button" onclick="testDebouncing()">æµ‹è¯•é˜²æŠ–æœºåˆ¶</button>
            <button class="test-button" onclick="setCollisionSensitivity(30)">è®¾ç½®é«˜æ•æ„Ÿåº¦</button>
            <button class="test-button" onclick="setCollisionSensitivity(60)">è®¾ç½®é»˜è®¤æ•æ„Ÿåº¦</button>
            <button class="test-button" onclick="setCollisionSensitivity(100)">è®¾ç½®ä½æ•æ„Ÿåº¦</button>
        </div>
        
        <div class="test-section">
            <h3>äº‹ä»¶æ—¥å¿—</h3>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
            <div id="log" class="log-area"></div>
        </div>
    </div>

    <script>
        let logElement = document.getElementById('log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            logElement.textContent = '';
        }
        
        function showStatus(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${isSuccess ? 'success' : 'error'}">${message}</div>`;
        }
        
        function checkSystemStatus() {
            log('ğŸ” æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...');
            
            const checks = [
                { name: 'window.onPlayerCollisionStart', exists: typeof window.onPlayerCollisionStart === 'function' },
                { name: 'window.onPlayerCollisionEnd', exists: typeof window.onPlayerCollisionEnd === 'function' },
                { name: 'window.onPlayerCollision', exists: typeof window.onPlayerCollision === 'function' },
                { name: 'window.getCurrentCollisions', exists: typeof window.getCurrentCollisions === 'function' },
                { name: 'window.getCollisionHistory', exists: typeof window.getCollisionHistory === 'function' },
                { name: 'window.setCollisionSensitivity', exists: typeof window.setCollisionSensitivity === 'function' },
                { name: 'window.testCollisionSystem', exists: typeof window.testCollisionSystem === 'function' }
            ];
            
            let allPassed = true;
            let statusMessage = '<h4>ç³»ç»Ÿæ£€æŸ¥ç»“æœ:</h4><ul>';
            
            checks.forEach(check => {
                const status = check.exists ? 'âœ…' : 'âŒ';
                statusMessage += `<li>${status} ${check.name}</li>`;
                if (!check.exists) allPassed = false;
                log(`${status} ${check.name}: ${check.exists ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            });
            
            statusMessage += '</ul>';
            
            if (allPassed) {
                statusMessage += '<p style="color: green;">âœ… æ‰€æœ‰ç³»ç»ŸåŠŸèƒ½æ­£å¸¸ï¼</p>';
                log('âœ… ç³»ç»ŸçŠ¶æ€æ£€æŸ¥é€šè¿‡');
            } else {
                statusMessage += '<p style="color: red;">âŒ éƒ¨åˆ†åŠŸèƒ½ç¼ºå¤±ï¼Œè¯·æ£€æŸ¥æ¸¸æˆæ˜¯å¦å·²åŠ è½½</p>';
                log('âŒ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å¤±è´¥');
            }
            
            showStatus('system-status', statusMessage, allPassed);
        }
        
        function testCollisionEvents() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•ç¢°æ’äº‹ä»¶...');
            
            if (typeof window.testCollisionSystem === 'function') {
                const result = window.testCollisionSystem();
                if (result.success) {
                    log(`âœ… ${result.message}`);
                    showStatus('collision-status', `æµ‹è¯•æˆåŠŸ: ${result.message}`, true);
                } else {
                    log(`âŒ ${result.message}`);
                    showStatus('collision-status', `æµ‹è¯•å¤±è´¥: ${result.message}`, false);
                }
            } else {
                log('âŒ testCollisionSystem å‡½æ•°ä¸å­˜åœ¨');
                showStatus('collision-status', 'æµ‹è¯•å¤±è´¥: æ¸¸æˆæœªåŠ è½½æˆ–å‡½æ•°ä¸å­˜åœ¨', false);
            }
        }
        
        function getCurrentCollisions() {
            log('ğŸ“Š è·å–å½“å‰ç¢°æ’çŠ¶æ€...');
            
            if (typeof window.getCurrentCollisions === 'function') {
                const collisions = window.getCurrentCollisions();
                log(`å½“å‰ç¢°æ’æ•°é‡: ${collisions.length}`);
                
                if (collisions.length > 0) {
                    collisions.forEach((player, index) => {
                        log(`ç¢°æ’ ${index + 1}: ${player.name} (ID: ${player.id})`);
                    });
                } else {
                    log('å½“å‰æ²¡æœ‰æ´»åŠ¨çš„ç¢°æ’');
                }
                
                showStatus('collision-status', `å½“å‰ç¢°æ’: ${collisions.length} ä¸ª`, true);
            } else {
                log('âŒ getCurrentCollisions å‡½æ•°ä¸å­˜åœ¨');
                showStatus('collision-status', 'è·å–å¤±è´¥: å‡½æ•°ä¸å­˜åœ¨', false);
            }
        }
        
        function getCollisionHistory() {
            log('ğŸ“š è·å–ç¢°æ’å†å²...');
            
            if (typeof window.getCollisionHistory === 'function') {
                const history = window.getCollisionHistory();
                log(`ç¢°æ’å†å²è®°å½•æ•°é‡: ${history.length}`);
                
                if (history.length > 0) {
                    const recent = history.slice(-5); // æ˜¾ç¤ºæœ€è¿‘5æ¡
                    recent.forEach((event, index) => {
                        const time = new Date(event.timestamp).toLocaleTimeString();
                        log(`${event.eventType === 'start' ? 'ğŸ¯' : 'ğŸ”š'} ${time}: ${event.targetPlayer.name} (${event.eventType})`);
                    });
                } else {
                    log('æš‚æ— ç¢°æ’å†å²è®°å½•');
                }
                
                showStatus('collision-status', `å†å²è®°å½•: ${history.length} æ¡`, true);
            } else {
                log('âŒ getCollisionHistory å‡½æ•°ä¸å­˜åœ¨');
                showStatus('collision-status', 'è·å–å¤±è´¥: å‡½æ•°ä¸å­˜åœ¨', false);
            }
        }
        
        function testDebouncing() {
            log('â±ï¸ æµ‹è¯•é˜²æŠ–æœºåˆ¶...');
            log('é˜²æŠ–æœºåˆ¶ä¼šåœ¨ç¢°æ’ç»“æŸå300msæ‰è§¦å‘ç»“æŸäº‹ä»¶');
            log('è¯·åœ¨æ¸¸æˆä¸­å¿«é€Ÿè¿›å‡ºå…¶ä»–ç©å®¶çš„ç¢°æ’èŒƒå›´æ¥æµ‹è¯•');
            showStatus('collision-status', 'é˜²æŠ–æµ‹è¯•: è¯·åœ¨æ¸¸æˆä¸­æµ‹è¯•å¿«é€Ÿç¢°æ’', true);
        }
        
        function setCollisionSensitivity(radius) {
            log(`ğŸ›ï¸ è®¾ç½®ç¢°æ’æ•æ„Ÿåº¦ä¸º: ${radius}px`);
            
            if (typeof window.setCollisionSensitivity === 'function') {
                window.setCollisionSensitivity(radius);
                log(`âœ… ç¢°æ’æ•æ„Ÿåº¦å·²è®¾ç½®ä¸º ${radius}px`);
                showStatus('collision-status', `æ•æ„Ÿåº¦å·²è®¾ç½®ä¸º: ${radius}px`, true);
            } else {
                log('âŒ setCollisionSensitivity å‡½æ•°ä¸å­˜åœ¨');
                showStatus('collision-status', 'è®¾ç½®å¤±è´¥: å‡½æ•°ä¸å­˜åœ¨', false);
            }
        }
        
        // ç›‘å¬ç¢°æ’äº‹ä»¶
        window.addEventListener('player-collision-start', (event) => {
            const player = event.detail.targetPlayer;
            log(`ğŸ¯ ç¢°æ’å¼€å§‹äº‹ä»¶: ${player.name}`);
        });
        
        window.addEventListener('player-collision-end', (event) => {
            const player = event.detail.targetPlayer;
            const duration = event.detail.duration;
            log(`ğŸ”š ç¢°æ’ç»“æŸäº‹ä»¶: ${player.name} (æŒç»­ ${duration}ms)`);
        });
        
        window.addEventListener('player-collision', (event) => {
            const player = event.detail.playerData;
            log(`ğŸ¤ ç©å®¶ç¢°æ’äº‹ä»¶ (å…¼å®¹æ¨¡å¼): ${player.name}`);
        });
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.addEventListener('load', () => {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            
            // ç­‰å¾…æ¸¸æˆåŠ è½½
            setTimeout(() => {
                log('ğŸ® å¼€å§‹æ£€æŸ¥æ¸¸æˆç³»ç»Ÿ...');
                checkSystemStatus();
            }, 1000);
        });
        
        // ç›‘å¬æ¸¸æˆå‡†å¤‡äº‹ä»¶
        window.addEventListener('phaser-game-ready', () => {
            log('ğŸ® Phaseræ¸¸æˆå·²å‡†å¤‡å°±ç»ª');
            setTimeout(checkSystemStatus, 500);
        });
    </script>
</body>
</html>